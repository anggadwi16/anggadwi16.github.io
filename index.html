<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8"/>
	<title>Liga Inggris | Premier League</title>
	<meta name="description" content="Liga Inggris"/>
	<meta name="viewport" content="width=device-width, initial-scale=1"/>
	<meta name="theme-color" content="#0a0a0a">
	<link rel="manifest" href="/manifest.json"/>
	<link rel="stylesheet" href="css/materialize.min.css">
	<link rel="stylesheet" href="css/style.css">
	<link rel="shortcut icon" href="/img/icon.png">
	<link rel="apple-touch-icon" href="img//apple-touch-icon-180x180.png">
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">


</head>
<body>
	<!-- Navigasi -->
	<nav class="nav-color lighten-1" role="navigation">
		<div class="nav-wrapper container">
			<a href="#" class="sidenav-trigger" data-target="nav-mobile">â˜°</a>
			<a href="#" class="left" id="logo-container"><img class="img-logo" src="/img/icon.png" alt="logo"/></a>
			<span class="left">Premier League</span>
			<ul class="topnav right hide-on-med-and-down"></ul>
			<ul class="sidenav" id="nav-mobile"></ul>
		</div>
	</nav>

	<!-- BODY CONTENT -->
	<div class="container" id="body-content">
	</div>
	<script src="js/materialize.min.js"></script>
	<script src="js/api.js"></script>
	<script src="js/nav.js"></script>
	<script src="js/idb.js"></script>
	<script src="js/db.js"></script>


	<script type="text/javascript">

		//Periksa service worker
		if(!('serviceWorker' in navigator)){
			console.log("serviceWorker tidak didukung browser ini");
		}else{
			requestPermission();
		}

		function saveMatch(id, date, home, away){
			let data = {

				id : id,
				date : date,
				home : home,
				away : away,
				
			};

			console.log(data);

			saveMatches(data);
			
			
		}

		function requestPermission(){
			if('Notification' in window){
				Notification.requestPermission().then(function(result){
					if(result === "denied"){
						console.log("Fitur notifikasi tidak dijinkan");
						return;
					}else if(result === "default"){
						console.error("Pengguna menutup kotak dialog permintaan ijin");
						return;
					}

					navigator.serviceWorker.ready.then(() => {
						if(('PushManager' in window)){
							navigator.serviceWorker.getRegistration().then(function(registration){
								registration.pushManager.subscribe({
									userVisibleOnly : true,
									applicationServerKey : urlBase64ToUint8Array("BIJjZAVel1bnCgcSjw2r0twvkd8YCujQlOB50Su4JxfaDITv-o2zOgfIvMA57K7p7ymhhTlStSZS3ToIl5saukY")
								}).then(function(subscribe){
									console.log("Berhasil melakukan subscribe dengan endpoint : ", subscribe.endpoint);
									console.log("Berhasil melakukan subscribe dengan p256dh key : ", btoa(String.fromCharCode.apply(null, new Uint8Array(subscribe.getKey('p256dh')))));
									console.log("Berhasil melakukan subscribe dengan auth key : ", btoa(String.fromCharCode.apply(null, new Uint8Array(subscribe.getKey('auth')))))
								})
								.catch(function(e){
									console.error("Tidak dapat melakukan subscribe ", e.message);
								})
							})
						}
					});
					
				});
			}
		}

		function urlBase64ToUint8Array(base64String) {
		    const padding = '='.repeat((4 - base64String.length % 4) % 4);
		    const base64 = (base64String + padding)
		        .replace(/-/g, '+')
		        .replace(/_/g, '/');
		    const rawData = window.atob(base64);
		    const outputArray = new Uint8Array(rawData.length);
		    for (let i = 0; i < rawData.length; ++i) {
		        outputArray[i] = rawData.charCodeAt(i);
		    }
		    return outputArray;
		}
		
		//Register service worker
		if("serviceWorker" in navigator){
			window.addEventListener("load", function(){
				navigator.serviceWorker
					.register("/service-worker.js")
					.then(function(){
						console.log("Pendaftaran service worker berhasil");
					})
					.catch(function(){
						console.log("Pendaftaran service worker gagal");
					});
			});
		}else{
			console.log("service worker belum didukung oleh browser");
		}

	</script>
		
</body>
</html>